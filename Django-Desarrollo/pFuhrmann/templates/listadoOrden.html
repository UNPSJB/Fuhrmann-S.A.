{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block contenido %}
<div class="container">
    <div class="panel panel-yellow">
        <div class="panel-heading clearfix">
            <h4 class="panel-title pull-left" style="padding-top: 7.5px;"><strong>Listado de Orden de Producción</strong></h4>
            <div class="btn-group pull-right">
                <div class="input-group">
                    <div class="btn-group pull-right">
                        <a class="btn btn-default" type="button" href="#" title="Ayuda" onmouseDown = "alert('Error 404 - Dont Implement')"><span class="glyphicon glyphicon-question-sign"></span></a>
                    </div>
                    <span class="input-group-btn">
                        <a class="btn btn-default" type="button" title="Buscar Ej: Nro. Orden" onClick="javascript: errorBuscar('/buscarOrden/', $('#buscar').val());"><span class="glyphicon glyphicon-search"></span></a>
                    </span>
                    <input type="text" id = "buscar" class="form-control" placeholder="Buscar"></input>
                </div> 
            </div>
        </div>
        <div class="panel-body">
            <table  class="table table-striped table-bordered table-condensed" id="tableLote">
                <thead>
                    <tr>
                        <th style="text-align:center;" width="15%">Fecha de Emisión</th>
                        <th style="text-align:center;" width="15%">Inicio Produccion</th>
                        <th style="text-align:center;" width="15%">Fin Produccion</th>
                        <th style="text-align:center;" width="12%">Maquina</th>
                        <th style="text-align:center;" width="5%">Proceso</th>
                        <th style="text-align:center;" width="5%">Finalizada</th>
                        <th style="text-align:center;" width="5%">Cancelada</th>
                        <th style="text-align:center;" width="40%">Acciones</th>
                    </tr>
                    {% for dato in lista %}
                    <tr>
                        <td style="text-align:center;" width="10%">{{dato.FechaEmision}}</td>
                        <td style="text-align:center;" width="10%">{{dato.FechaInicioProduccion}}</td>
                        <td style="text-align:center;" width="10%">{{dato.FechaFinProduccion}}</td>
                        <td style="text-align:center;" width="12%">{{dato.MaquinaActual}}</td>
                        <td style="text-align:center;" width="5%">{{dato.EnProduccion}}</td>
                        <td style="text-align:center;" width="5%">{{dato.Finalizada}}</td>
                        <td style="text-align:center;" width="5%">{{dato.Cancelada}}</td>
                        
                        <td style="text-align:center;" width="40%">
                            
                            <a class="btn btn-default" onClick="showModal('{{dato.NroOrden}}')" title="Ver Detalle"><span class="glyphicon glyphicon-eye-open"></span></a>

                            <a class="btn btn-default" onClick="comprobar('/modificarOrdenProduccion/{{dato.NroOrden}}', '{{dato.EnProduccion}}', '{{dato.Cancelada}}', '{{dato.Finalizada}}', 'Orden en Produccion o Cancelada!')" title="Modificar"><span class="glyphicon glyphicon-edit"></span></a>
                            
                            <a class="btn btn-default" onClick="cancelar('{{dato.NroOrden}}', '{{dato.EnProduccion}}', '{{dato.Cancelada}}', '{{dato.Finalizada}}', 'Orden en Produccion o Cancelada!')" title="Cancelar" ><span class="glyphicon glyphicon-remove"></span></a>
                            
                            <a class="btn btn-default" href="#" title="Enviar a Produccion"><span class="glyphicon glyphicon-share-alt"></span></a>
                            
                            <a class="btn btn-default" href="#" title="Finalizar Produccion"><span class="glyphicon glyphicon-warning-sign"></span></a>
                            </td>
                    </tr>

                    {% empty %}
                        <li> No existen ordenes de producción registradas </li>
                    {% endfor %}        
                </thead>
            </table>
            
            <div id='id'></div>

            <script type ="text/javascript"> </script>
            <div class="pull-right">
                <a class="btn btn-default btn-gr" type= "button" href="/registrarOrdenProduccion"  title = "Agregar Orden" >Nueva</a>
                <a class="btn btn-default btn-gr" type= "button"  id = 'button'  title = "Salir" >Salir</a>
            </div>            
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
    
    <script type="text/javascript">


        function showModal1(id){
            BootstrapDialog.show({
                title: ('Agregar Detalle a Orden Produccion - Nro: '+id),
                message: $('<div id="diss"></div>').load('/agregarDetalle/'+id),
                closable: false,
                cssClass: 'showfardo-dialog',
                onshown: function(dialog) {
                    var tier = $('.bootstrap-dialog').length - 1;
                    dialog.$modal.prev(".modal-backdrop")
                        .css("z-index", 1030 + tier * 30);
                    dialog.$modal
                        .css("z-index", 1040 + tier * 30);
                },
            });
        }

        function showModal(id) {

                var dialog1 = new BootstrapDialog.show({
                title: ('Datos de Orden Produccion - Nro. Orden: '+id),
                cssClass: 'show-dialog',
                closable: false,
                message: $('<div></div>').load('/verOrdenProduccion/'+id),
                onshown: function(dialog) {
                    var tier = $('.bootstrap-dialog').length - 1;
                    dialog.$modal.prev(".modal-backdrop")
                        .css("z-index", 1030 + tier * 30);
                    dialog.$modal
                        .css("z-index", 1040 + tier * 30);
                },
                buttons: [
                {
                    label: 'Agregar Detalle',
                    action: function(dialog){
                        showModal1(id);
                    },
                },
                {
                    label: 'Cancel',
                    action: function(dialogRef){
                        dialogRef.close();
                    }
                }]
            });
        };

        function comprobar(url, proceso, cancel, finalizada, msg) { /* Funcion para confirmar operaciones, 
                                            recibe como parametros la url en caso 
                                                de aceptar y el titulo */    
            if (proceso == 'True' || cancel == 'True' || finalizada == 'True'){
                BootstrapDialog.show({
                    title: 'Error',
                    cssClass: 'error-dialog',
                    message: msg,
                    type: BootstrapDialog.TYPE_DANGER, 
                    buttons: [
                        {
                            label: 'Aceptar',
                            action: function(dialogRef){
                                dialogRef.close();
                            }
                        }]
                });
            }
            else{
                window.location=url;
            }
        }

        function cancelar(orden, proceso, cancel, finalizada, msg){
            
            if (proceso == 'True' || cancel == 'True' || finalizada == 'True'){
                BootstrapDialog.show({
                    title: 'Error',
                    cssClass: 'error-dialog',
                    message: msg,
                    type: BootstrapDialog.TYPE_DANGER, 
                    buttons: [
                        {
                            label: 'Aceptar',
                            action: function(dialogRef){
                                dialogRef.close();
                            }
                        }]
                });
            }
            else{
                eliminar('/cancelarOrdenProduccion/'+orden, 'Cancelar O. Produccion', '¿Está seguro que quiere cancelar la Orden?');
            }
        }

    </script>

{% endblock %}


